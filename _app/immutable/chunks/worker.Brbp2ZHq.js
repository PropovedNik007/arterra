import{g as Y}from"./_commonjsHelpers.CqkleIqs.js";import{a as T}from"./is-graph.BnP-TWIV.js";function V(e){return!e||typeof e!="object"||typeof e=="function"||Array.isArray(e)||e instanceof Set||e instanceof Map||e instanceof RegExp||e instanceof Date}function I(e,s){e=e||{};var t={};for(var i in s){var l=e[i],a=s[i];if(!V(a)){t[i]=I(l,a);continue}l===void 0?t[i]=a:t[i]=l}return t}var _=I,D={};function P(e){return typeof e!="number"||isNaN(e)?1:e}function K(e,s){var t={},i=function(r){return typeof r>"u"?s:r};typeof s=="function"&&(i=s);var l=function(r){return i(r[e])},a=function(){return i(void 0)};return typeof e=="string"?(t.fromAttributes=l,t.fromGraph=function(r,n){return l(r.getNodeAttributes(n))},t.fromEntry=function(r,n){return l(n)}):typeof e=="function"?(t.fromAttributes=function(){throw new Error("graphology-utils/getters/createNodeValueGetter: irrelevant usage.")},t.fromGraph=function(r,n){return i(e(n,r.getNodeAttributes(n)))},t.fromEntry=function(r,n){return i(e(r,n))}):(t.fromAttributes=a,t.fromGraph=a,t.fromEntry=a),t}function L(e,s){var t={},i=function(r){return typeof r>"u"?s:r};typeof s=="function"&&(i=s);var l=function(r){return i(r[e])},a=function(){return i(void 0)};return typeof e=="string"?(t.fromAttributes=l,t.fromGraph=function(r,n){return l(r.getEdgeAttributes(n))},t.fromEntry=function(r,n){return l(n)},t.fromPartialEntry=t.fromEntry,t.fromMinimalEntry=t.fromEntry):typeof e=="function"?(t.fromAttributes=function(){throw new Error("graphology-utils/getters/createEdgeValueGetter: irrelevant usage.")},t.fromGraph=function(r,n){var d=r.extremities(n);return i(e(n,r.getEdgeAttributes(n),d[0],d[1],r.getNodeAttributes(d[0]),r.getNodeAttributes(d[1]),r.isUndirected(n)))},t.fromEntry=function(r,n,d,x,w,p,G){return i(e(r,n,d,x,w,p,G))},t.fromPartialEntry=function(r,n,d,x){return i(e(r,n,d,x))},t.fromMinimalEntry=function(r,n){return i(e(r,n))}):(t.fromAttributes=a,t.fromGraph=a,t.fromEntry=a,t.fromMinimalEntry=a),t}D.createNodeValueGetter=K;D.createEdgeValueGetter=L;D.createEdgeWeightGetter=function(e){return L(e,P)};const{createNodeValueGetter:q,createEdgeValueGetter:R}=D;var U=function(s,t,i){const{nodeXAttribute:l,nodeYAttribute:a}=i,{attraction:r,repulsion:n,gravity:d,inertia:x,maxMove:w}=i.settings;let{shouldSkipNode:p,shouldSkipEdge:G,isNodeFixed:M}=i;M=q(M),p=q(p,!1),G=R(G,!1);const E=s.filterNodes((f,c)=>!p.fromEntry(f,c)),N=E.length;for(let f=0;f<N;f++){const c=E[f],o=s.getNodeAttributes(c),u=t[c];u?t[c]={dx:u.dx*x,dy:u.dy*x,x:o[l]||0,y:o[a]||0}:t[c]={dx:0,dy:0,x:o[l]||0,y:o[a]||0}}if(n)for(let f=0;f<N;f++){const c=E[f],o=t[c];for(let u=f+1;u<N;u++){const h=E[u],y=t[h],k=y.x-o.x,g=y.y-o.y,m=Math.sqrt(k*k+g*g)||1,v=n/m*k,b=n/m*g;o.dx-=v,o.dy-=b,y.dx+=v,y.dy+=b}}if(r&&s.forEachEdge((f,c,o,u,h,y,k)=>{if(o===u||p.fromEntry(o,h)||p.fromEntry(u,y)||G.fromEntry(f,c,o,u,h,y,k))return;const g=t[o],m=t[u],v=m.x-g.x,b=m.y-g.y,S=Math.sqrt(v*v+b*b)||1,$=r*S*v,j=r*S*b;g.dx+=$,g.dy+=j,m.dx-=$,m.dy-=j}),d)for(let f=0;f<N;f++){const c=E[f],o=t[c],{x:u,y:h}=o,y=Math.sqrt(u*u+h*h)||1;t[c].dx-=u*d*y,t[c].dy-=h*d*y}const X=!1;for(let f=0;f<N;f++){const c=E[f],o=t[c],u=Math.sqrt(o.dx*o.dx+o.dy*o.dy);u>w&&(o.dx*=w/u,o.dy*=w/u),M.fromGraph(s,c)?o.fixed=!0:(o.x+=o.dx,o.y+=o.dy,o.fixed=!1)}return{converged:X}},C={};C.assignLayoutChanges=function(e,s,t){const{nodeXAttribute:i,nodeYAttribute:l}=t;e.updateEachNodeAttributes((a,r)=>{const n=s[a];return!n||n.fixed||(r[i]=n.x,r[l]=n.y),r},{attributes:["x","y"]})};C.collectLayoutChanges=function(e){const s={};for(const t in e){const i=e[t];s[t]={x:i.x,y:i.y}}return s};var W={nodeXAttribute:"x",nodeYAttribute:"y",isNodeFixed:"fixed",shouldSkipNode:null,shouldSkipEdge:null,settings:{attraction:5e-4,repulsion:.1,gravity:1e-4,inertia:.6,maxMove:200}};const z=T,B=_,F=U,H=C,J=W;function A(e,s){if(!z(e))throw new Error("graphology-layout-force/worker: the given graph is not a valid graphology instance.");s=B(s,J),this.callbacks={},s.onConverged&&(this.callbacks.onConverged=s.onConverged),this.graph=e,this.params=s,this.nodeStates={},this.frameID=null,this.running=!1,this.killed=!1}A.prototype.isRunning=function(){return this.running};A.prototype.runFrame=function(){let{converged:e}=F(this.graph,this.nodeStates,this.params);H.assignLayoutChanges(this.graph,this.nodeStates,this.params),e=!1,e?(this.callbacks.onConverged&&this.callbacks.onConverged(),this.stop()):this.frameID=window.requestAnimationFrame(()=>this.runFrame())};A.prototype.stop=function(){return this.running=!1,this.frameID!==null&&(window.cancelAnimationFrame(this.frameID),this.frameID=null),this};A.prototype.start=function(){if(this.killed)throw new Error("graphology-layout-force/worker.start: layout was killed.");this.running||(this.running=!0,this.runFrame())};A.prototype.kill=function(){this.stop(),delete this.nodeStates,this.killed=!0};var Q=A;const Z=Y(Q),et=Object.freeze(Object.defineProperty({__proto__:null,default:Z},Symbol.toStringTag,{value:"Module"}));export{et as w};
